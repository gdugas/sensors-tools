#! /usr/bin/python
# -*- coding: utf-8 -*-

import os,sys
wdir = os.path.abspath( os.path.dirname(sys.argv[0]) + '/..' )
sys.path.append(wdir)

from xml.dom.minidom import parseString
from time import time

import sensorsConf, sensors.db, sensors.output

now	= int( time() )


if not os.path.exists(sensorsConf.DB_name):
	sensors.db.create()

dom = parseString(sensors.output.Xml())

valuesTemp = {}
valuesFans = {}
valuesVolts = {}


temps = dom.getElementsByTagName("temperatures")[0]
valuesTemp['date'] = []
valuesTemp['dev'] = []
valuesTemp['num'] = []
valuesTemp['type'] = []
valuesTemp['value']= []

for temp in temps.getElementsByTagName("temperature"):
	valuesTemp['date'].append(now)
	valuesTemp['dev'].append(temp.getAttribute('name'))
	valuesTemp['num'].append(temp.getAttribute('num'))
	valuesTemp['type'].append('temp')
	valuesTemp['value'].append(temp.getAttribute('value'))

sensors.db.insert(valuesTemp)

fans	= dom.getElementsByTagName("fans")[0]
valuesFans['date'] = []
valuesFans['dev'] = []
valuesFans['num'] = []
valuesFans['type'] = []
valuesFans['value']= []

for fan in fans.getElementsByTagName("fan"):
	valuesFans['date'].append(now)
	valuesFans['dev'].append(fan.getAttribute('name'))
	valuesFans['num'].append(fan.getAttribute('num'))
	valuesFans['type'].append('fan')
	valuesFans['value'].append(fan.getAttribute('value'))

sensors.db.insert(valuesFans)

volts	= dom.getElementsByTagName("voltages")[0]
valuesVolts['date'] = []
valuesVolts['dev'] = []
valuesVolts['num'] = []
valuesVolts['type'] = []
valuesVolts['value']= []

for volt in volts.getElementsByTagName("voltage"):
	valuesVolts['date'].append(now)
	valuesVolts['dev'].append(volt.getAttribute('name'))
	valuesVolts['num'].append(volt.getAttribute('num'))
	valuesVolts['type'].append('volt')
	valuesVolts['value'].append(volt.getAttribute('value'))

sensors.db.insert(valuesVolts)
